# Компактная инструкция по созданию Laravel-проектов

[TOC]

## Установка

- [ ] 1. Установить [XAMPP](https://www.apachefriends.org/ru/index.html) и добавить путь к файлу xampp\php\php.exe в в переменную %PATH% (чтобы php можно было вызывать в любой папке без указания пути к нему).
- [ ] Установить [Composer](https://getcomposer.org/).
- [ ] Перейти в папку с проектами и выполнить в терминале команду с указанием желаемой версии Laravel:
```
    composer create-project laravel/laravel my_new_project "9.1.*"
```
Если не указывать версию, то будет установлена самая последняя.

## Запуск сервера

Для запуска сайта локально нужно выполнить в терминале команду:
``` 
    php artisan serve
```
Сайт станет доступен по адресу: http://127.0.0.1:8000

## Создание пользовательских маршрутов

В файле `.\routes\web.php` прописываются правила, что именно сервер должен отдавать браузеру при запросе того или иного ресурса URI. Для этого прописываются вызовы методов (`get`,`post` и пр.) класса `Route`. В аргументах каждого вызова задаётся маршрут: в первом аргументе адрес (URI) страницы сайта, а во втором - callback-функция (замыкание), возвращающая содержимое веб-страницы. 
Методы вызываются в порядке их объявления, и если какой-то из них оказался соответсвующим запрошенному URI, то вызов остальных методов прекращается.

### Способы создания марштрутов

#### 1. Вывод простого текста
```
	Route::get('/hello', function () {
  	  return 'Hello World!';
	});
```
по адресу http://127.0.0.1:8000/hello появится текст `Hello World!`

#### 2. Вывод ответа сервера с заголовком и/или кодом ответа

Объекты класса `responce` обладают методом `header`, который добавляет к ответу заголовок `<head>`.
```
    Route::get('/hello-head', function () { 
        return response('Привет!') -> header('Content-Type', 'text/plain');  
    });
```

Вторым аргументом можно указать код ответа, отличный от 200:
```
    Route::get('/empty', function () { // Можно указать код ответа, отличный от 200
        return response('Здесь ничего нет.', 403);  
    });
```

#### 3. Вывод одного из представлений (view), заданного blade-шаблоном:
```
	Route::get('/welcome_to_laravel', function () {
   		return view('welcome');
	});
```
По адресу http://127.0.0.1:8000/hello отобразится шаблон из файла `.\resources\views\welcome.blade.php`

То же самое более компактно - через метод view класса Route:
``` 
	Route::view('/welcome2_to_laravel', 'welcome');  
```

#### 4. Вызов одного из контроллеров с последующим ответом от него

Для этого предварительно нужно в контроллере создать метод (функцию класса), возвращающий "ответ сервера" (т.н. responce). Поскольку мы пока не создали своих новых контроллеров, то метод можно прописать в единственном имеющемся (он находится в файле `.\app\Http\Controllers\Controller.php`). Добавляем этот код метода в класс контроллера (внутрь блока кода `class Controller ...` ):
```
    public function showText() {
        return 'Привет от контроллера!';
    }
```
После того как контроллер подготовлен, можно добавить в файл `.\routes\web.php` новый маршрут к этому методу контроллера. Вызов callback-методов, находящихся внутри класса, делается указанием массива из двух строк (полного пути к классу и имени метода):
```
	Route::get('/ctrl-hello', ['App\Http\Controllers\Controller', 'showText']);
```
Теперь по адресу http://127.0.0.1:8000/ctrl-hello можно увидеть ответ от контроллера.

Если подключить контроллер директивой `use`, то можно не писать полный путь к нему, а через краткое имя обратиться к встроенной константе `class`, хранящей полное имя класса:
```
	use App\Http\Controllers\Controller;
	Route::get('/ctrl-hello', [Controller::class, 'showText']);
```

#### 5. Переадресация
Простой редирект с кодом возврата 302:
```
    Route::redirect('/hi', '/hello'); 
```
Третьим параметром можно указать другой код возврата:
```
    Route::redirect('/hi2', '/hello', 301); 
```
Такой же код 301 возвращает метод `permanentRedirect`
```
    Route::permanentRedirect('/hi3', '/hello'); 
```

#### 6. Запасной маршрут
Если входящий запрос не соответствуюет ни одному из предыдущих маршрутов, то его можно обработать методом `fallback`, который направит запрос по маршруту вместо ответа `404 - страница не найдена`:
```
	Route::fallback([Controller::class, 'showText']);
```

Иллюстрация схемы, как эти 6 вариантов маршрутов работают:
![схема](https://rusite.su/wp-content/uploads/2024/02/MVC-routes.png)